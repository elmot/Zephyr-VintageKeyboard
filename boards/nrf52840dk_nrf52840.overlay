#include <zephyr/dt-bindings/input/input-event-codes.h>
#include <zephyr/dt-bindings/input/keymap.h>
#include "../hid.overlay"
// Junie: I have identified the i2c1 pins in the devicetree as P0.30 (SDA) and P0.31 (SCL).
&i2c1 {
	status = "okay";
	clock-frequency = <400000>;

	sx1509b: sx1509b@3e {
		compatible = "semtech,sx1509b";
		reg = <0x3e>;
		/* Optional interrupt and reset GPIOs â€” adjust per your wiring
		 * int-gpios = <&gpio0 11 GPIO_ACTIVE_LOW>;
		 * reset-gpios = <&gpio0 12 GPIO_ACTIVE_LOW>;
		 */
		label = "SX1509B";
		gpio-controller;
		#gpio-cells = <2>;
		ngpios = <16>;
	};
};

/ {

	/* Keyboard scan matrix on SX1509B: currently 3 rows x 2 cols enabled */
	kscan0: kscan {
		compatible = "gpio-kbd-matrix";
		/* Rows are inputs with pull-ups; active when driven low by a pressed key */
		row-gpios = <&sx1509b 8 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
					<&sx1509b 9 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
					<&sx1509b 10 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
					<&sx1509b 11 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
					<&sx1509b 12 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
					<&sx1509b 13 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
					<&sx1509b 14 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>,
					<&sx1509b 15 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;
		/* Cols are outputs, driven low one at a time during scan */
		col-gpios = <&sx1509b 0 GPIO_ACTIVE_LOW>,
					<&sx1509b 1 GPIO_ACTIVE_LOW>,
					<&sx1509b 2 GPIO_ACTIVE_LOW>,
					<&sx1509b 3 GPIO_ACTIVE_LOW>,
					<&sx1509b 4 GPIO_ACTIVE_LOW>,
					<&sx1509b 5 GPIO_ACTIVE_LOW>,
					<&sx1509b 6 GPIO_ACTIVE_LOW>,
					<&sx1509b 7 GPIO_ACTIVE_LOW>;
		/* Use continuous scanning since GPIO expander interrupts may not be available */
		idle-mode = "scan";
		poll-period-ms = <0>;
		poll-timeout-ms = <0>;
		debounce-down-ms = <0>;
		debounce-up-ms = <0>;
	};

	/* Create a grouping for your custom LEDs */
	ext_leds {
		compatible = "gpio-leds";

		caps_lock_led: caps_lock_led {
			gpios = <&gpio0 13 GPIO_ACTIVE_LOW>;
			label = "External LED 0";
		};

		ext_led1: led_1 {
			gpios = <&gpio0 15 GPIO_ACTIVE_LOW>;
			label = "External LED 1";
		};

		ext_led2: led_2 {
			gpios = <&gpio0 17 GPIO_ACTIVE_LOW>;
			label = "External LED 2";
		};

		pwr_on_led: pwr_on_led {
//			gpios = <&gpio0 20 GPIO_ACTIVE_LOW>;
			gpios = <&gpio1 11 GPIO_ACTIVE_LOW>;
			label = "PWR LED";
		};

		ble_connected_led: ble_connected_led {
//			gpios = <&gpio0 22 GPIO_ACTIVE_LOW>;
			gpios = <&gpio1 10 GPIO_ACTIVE_LOW>;
			label = "BLE LED";
		};

		usb_connected_led: usb_connected_led {
//			gpios = <&gpio0 24 GPIO_ACTIVE_LOW>;
			gpios = <&gpio1 12 GPIO_ACTIVE_LOW>;
			label = "USB LED";
		};
	};
	
	/* Create aliases so we can refer to them easily in C code (led0, led1...) */
	aliases {
		caps-lock-led = &caps_lock_led;
		pwr-on-led = &pwr_on_led;
		ble-connected-led = &ble_connected_led;
		usb-connected-led = &usb_connected_led;
	};
};
